\documentclass[../manuale_sviluppatore.tex]{subfiles}

\begin{document}

\subsection{Design Pattern architetturale: MVP}
Il design pattern architetturale scelto per il prodotto è il \glossario{Model View Presenter}, di 
conseguenza le componenti principali del prodotto sono le seguenti:
\begin{itemize}
	\item \textbf{Model}: tra i model figurano tutti i tipi che hanno il compito di mantenere i dati 
	del dominio, nello specifico vi sono \emph{Dataset} (rappresentante il dataset caricato 
	nell'applicazione), \emph{DistanceMatrix} (rappresentante la matrice delle distanze associata 
	al dataset caricato)e i modelli delle visualizzazioni che preservano la configurazione delle 
	stesse;
	\item \textbf{Presenter}: tra i presenter figurano tutti i tipi che implementano la logica di 
	business e la logica di visualizzazione, in particolare vi sono i presenter delle 
	visualizzazioni, dei \glossario{components} e i manager dell'applicazione che ne gestiscono il 
	corretto funzionamento;
	\item \textbf{View}: le view sono dei tipi sostanzialmente passivi che visualizzano i dati di 
	dominio secondo la configurazione dell'applicazione, ed indirizzano gli eventi ai presenter 
	affinchè essi li elaborino e producano degli aggiornamenti coerenti con li stessi; tra le view 
	vi sono il codice HTML dei grafici e i diversi tipi degli elementi di modifica dei grafici.
\end{itemize}

Nell'architettura di \emph{HD-Viz} ciascun component è composto da un presenter e da una view, 
non necessita di un modello specifico in quanto i dati dipendono dal modello dei grafici, dal 
dataset o dalla matrice delle distanze. Nel caso dei grafici invece la view viene realizzata 
tramite le funzionalità di D3.

\begin{figure}[H]
	\centering
	\includegraphics[width=18cm]{img/patternMVP.jpg}
	\caption{Pattern MVP}
\end{figure}

\subsection{Architettura di dettaglio}
\subsubsection{Il client}

Per la definizione dei package del prodotto si è deciso di seguire il principio di progettazione 
\emph{Common Reuse Principle}, di modo da avere tipi che vengono utilizzati assieme all'interno 
dello stesso package.

\begin{figure}[H]
	\centering
	\includegraphics[width=10cm]{img/packageDiagramOverview.pdf}
	\caption{Struttura generale HD-Viz}
\end{figure}

I package principali sono:
\begin{itemize}
	\item \textbf{Util}: all'interno del package sono presenti tutti i tipi di supporto necessari 
	nell'applicazione, come per esempio l'implementazione del design pattern observer, largamente 
	utilizzata all'interno del prodotto;
	\item \textbf{Core}: all'interno del package vi sono tutti i tipi relativi alle strutture dati 
	cardine del prodotto, ossia il \emph{Dataset} e la \emph{DistanceMatrix}, oltre 
	all'implementazione del design pattern strategy per la scelta della distanza da utilizzare;
	\item \textbf{HD-Viz}: contiene i manager, tipi che realizzano la \emph{dependency inversion} e 
	garantiscono il corretto funzionamento dell'applicazione;
	\item \textbf{Graphs}: package che contiene i tipi dei modelli, dei presenter e le view dei 
	grafici di HD-Viz;
	\item \textbf{Components}: contiene i tipi dei presenters e delle views dei diversi componenti, 
	ossia quegli elementi che si interfacciano con il \emph{Dataset}, la \emph{DistanceMatrix} o i 
	modelli dei grafici e ne modificano i dati o le proprietà di visualizzazione.
\end{itemize}

Il tipo \emph{HDVizmanager} è il core dell'architettura, esso implementa la \emph{dependency inversion}, 
infatti si occupa di tener traccia dei dati per evitare istanze multiple del \glossario{Dataset}, 
della \emph{DistanceMatrix} e dei grafici una volta creati. 
Nel momento in cui viene modificato il dataset originale per modificare le visualizzazioni, esso 
funge da tramite creando una copia del dataset e usando quest'ultima per le modifiche, cosicchè il 
dataset originale resti invariato.
\emph{HdVizManager} collabora con diversi altri manager che si occupano di gestire aspetti più 
specifici dell'applicazione, come ad esempio \emph{GraphCreatorManager} che gestisce le factories 
per la creazione dei vari modelli dei grafici. 
Il \emph{CurrentGraphManager} verifica se le factories sono in grado di costruire il grafico, 
quindi si occupa di comunicare con il presenter e il modello del grafico relativo.


\begin{figure}[H]
	\centering
	\includegraphics[width=18cm]{img/core-hdvizmanager.jpg}
	\caption{HD-Viz Manager}
\end{figure}

Graphs contiene le diverse visualizzazioni che la nostra applicazione metterà a disposizione, Component mette a disposizione una serie di componenti che permettono di aggiungere funzionalità ai grafici.
Questi ultimi modificano le proprietà di visualizzazione dei grafici, dialogando con modelli tramite interfacce. Ciascun component ha un \emph{Presenter} che gestisce la logica e la \emph{View} che renderizza il tutto,
infatti tramite le interfacce ogni grafico implementerà dimensioni e colori a modo proprio.

\begin{figure}[H]
	\centering
	\includegraphics[width=18cm]{img/graph-e-hdviz.jpg}
	\caption{Relazioni tra graph e HD-Viz}
\end{figure}


Ciascun grafico eredita il \emph{GraphModel}; dentro il modello salverà le impostazioni del grafico, ad esempio il gradiente colori, il dataset, i label delle righe ed altro.

\begin{figure}[H]
	\centering
	\includegraphics[width=18cm]{img/graphs-e-components.jpg}
	\caption{Relazioni tra graphs e components}
\end{figure}


Collegando il model al presenter, i vari componenti che modificano la visualizzazione notificheranno il presenter; a sua volte modificherà il model, il quale si aggiornerà di conseguenza, 
e notificherà al presenter dei cambiamenti.
Ciò avverrà tramite i metodi update. In particolare al presenter verrà passato l'EventType, ovvero il tipo di evento occorso; in base a ciò si aggiornerà il modello, e quindi la visualizzazione.

\subsubsection{Il server}

Il lato server è stato realizzato con \emph{Express}, il quale si occuperà di gestire la sessione per collegarsi al server.
SQLApplication si occuperà di caricare la configurazione, che verrà passata ad SQLRoute.\\
Configuration e ConfigurationController si occuperanno di raccogliere le informazioni relative alla connessione con un database, la quale verrà stabilita tramite un file
json dove vi sarà presente la query.\\
MDataset (MinimalDataset) controllerà che il dataset passato sia valido perchè potrebbero esserci oggetti che non possono essere rappresentati. Successivamente
CSVApplication si occuperà di creare un file JSON che contenga i dati letti, se il file è corretto, allora CSVRuoute risponderà positivamente.

\begin{figure}[H]
	\centering
	\includegraphics[width=18cm]{img/server.jpg}
	\caption{Server HD-Viz}
\end{figure}

\end{document}